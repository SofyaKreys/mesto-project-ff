(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-26",headers:{authorization:"839b686b-1261-4d4d-8af6-118db8d9e09c","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}var n=document.querySelector("#card-template").content;function o(e,t,o){var r=t.deleteCard,c=t.likeCard,a=t.openImage,i=n.cloneNode(!0),l=i.querySelector(".card__image"),u=i.querySelector(".card__title"),d=i.querySelector(".card"),s=i.querySelector("#like-count");s.innerHTML=e.likes.length,d.dataset.idcard=e._id,l.src=e.link,l.alt=e.name,u.textContent=e.name,i.querySelector(".card__delete-button").addEventListener("click",r);var f=i.querySelector(".card__like-button");return f.addEventListener("click",(function(e){c(e,s,d,f)})),l.addEventListener("click",a),e.owner._id!=o&&i.querySelector("#card__delete").remove(),i}function r(e,n,o,r){r.classList.contains("card__like-button_is-active")?function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-26/cards/likes/".concat(e.dataset.idcard),{method:"DELETE",headers:{authorization:"839b686b-1261-4d4d-8af6-118db8d9e09c"}}).then(t).catch((function(e){console.log(e)}))}(o).then((function(e){n.innerHTML=e.likes.length,r.classList.remove("card__like-button_is-active")})).catch((function(e){console.log(e)})):function(e){return fetch("https://nomoreparties.co/v1/wff-cohort-26/cards/likes/".concat(e.dataset.idcard),{method:"PUT",headers:{authorization:"839b686b-1261-4d4d-8af6-118db8d9e09c"}}).then(t).catch((function(e){console.log(e)}))}(o).then((function(e){n.innerHTML=e.likes.length,r.classList.add("card__like-button_is-active")})).catch((function(e){console.log(e)}))}function c(e){var t=e.target.closest(".card");fetch("https://nomoreparties.co/v1/wff-cohort-26/cards/".concat(t.dataset.idcard),{method:"DELETE",headers:{authorization:"839b686b-1261-4d4d-8af6-118db8d9e09c"}}).then((function(e){return e.json()})).then((function(){t.remove()}))}function a(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",l)}function i(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",l)}function l(e){var t=document.querySelector(".popup_is-opened");"Escape"===e.key&&t&&i(t)}function u(e){e.target===e.currentTarget&&i(e.target)}var d,s,f,p,m,v,h,_={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"},y=function(e,t){console.log(e,"тутутутуту");var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(_.inputErrorClass),n.classList.remove(_.errorClass),n.textContent=" "},g=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n),t.removeAttribute("disabled")):(t.classList.add(n),t.setAttribute("disabled",""))},b=function(e,t){var n=t.inputSelector,o=t.submitButtonSelector,r=t.inactiveButtonClass,c=Array.from(e.querySelectorAll(n)),a=e.querySelector(o);c.forEach((function(t){y(e,t)})),g(c,a,r)},E=document.querySelector(".places__list"),S=document.querySelector(".profile__description"),C=document.querySelector(".profile__title"),L=document.getElementById("popupNewCard"),k=document.querySelector(".profile__add-button"),q=L.querySelector(".popup__close"),x=document.forms["new-place"],B=x.elements["place-name"],I=x.elements.link,A=document.getElementById("popupEdit"),w=document.querySelector(".profile__edit-button"),T=A.querySelector(".popup__close"),D=document.forms["edit-profile"],N=D.elements.name,P=D.elements.description,U=document.getElementById("popupImage"),M=(document.querySelectorAll(".card__image"),U.querySelector(".popup__close")),H=U.querySelector(".popup__caption"),j=U.querySelector(".popup__image"),z=document.getElementById("editForm"),O=document.getElementById("popupNewPlace"),J=document.getElementById("buttonCard"),V=document.getElementById("buttonEdit"),F=document.getElementById("buttonAvatar"),G=document.querySelector(".profile__image"),K=document.getElementById("popupNewAvatar"),Q=K.querySelector(".popup__close"),R=document.forms.avatar,W=R.elements.link,X="";function Y(e){a(U),j.src=e.target.src,j.alt=e.target.alt;var t=e.target.closest(".card");H.textContent=t.querySelector(".card__title").textContent}k.addEventListener("click",(function(){a(L),b(L,_)})),q.addEventListener("click",(function(){return i(L)})),L.addEventListener("click",u),G.addEventListener("click",(function(){a(K),b(K,_)})),Q.addEventListener("click",(function(){return i(K)})),K.addEventListener("click",u),R.addEventListener("submit",(function(n){var o;n.preventDefault(),F.textContent="Сохранение...",(o=W.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then(t).catch((function(e){console.log(e)}))).then((function(e){G.style.backgroundImage="url(".concat(e.avatar,")"),R.reset(),i(K)})).catch((function(e){console.log(e)})).finally((function(){F.textContent="Сохранить"}))})),x.addEventListener("submit",(function(n){var a,l;n.preventDefault(),J.textContent="Сохранение...",(a=B.value,l=I.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:a,link:l})}).then(t).catch((function(e){console.log(e)}))).then((function(e){E.prepend(o(e,{deleteCard:c,likeCard:r,openImage:Y},X)),x.reset(),i(L)})).catch((function(e){console.log(e)})).finally((function(){J.textContent="Сохранить"}))})),w.addEventListener("click",(function(){a(A),b(A,_),N.value=C.textContent,P.value=S.textContent})),T.addEventListener("click",(function(){return i(A)})),A.addEventListener("click",u),D.addEventListener("submit",(function(n){var o,r;n.preventDefault(),V.textContent="Сохранение...",C.textContent=N.value,S.textContent=P.value,(o=N.value,r=P.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o,about:r})}).then(t).catch((function(e){console.log(e)}))).then((function(e){i(A)})).catch((function(e){console.log(e)})).finally((function(){V.textContent="Сохранить"}))})),U.querySelector(".popup__image"),M.addEventListener("click",(function(){return i(U)})),U.addEventListener("click",u),s=(d=_).formSelector,f=d.inputSelector,p=d.submitButtonSelector,m=d.inactiveButtonClass,v=d.inputErrorClass,h=d.errorClass,Array.from(document.querySelectorAll(s)).forEach((function(e){!function(e,t,n,o,r,c){var a=Array.from(e.querySelectorAll(t)),i=e.querySelector(n);g(a,i,o),a.forEach((function(t){t.addEventListener("input",(function(){(function(e,t,n,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?y(e,t):function(e,t,n,o,r){var c=e.querySelector(".".concat(t.id,"-error"));t.classList.add(o),c.textContent=n,c.classList.add(r)}(e,t,t.validationMessage,n,o)})(e,t,r,c),g(a,i,o)}))}))}(e,f,p,m,v,h)})),z.addEventListener("submit",(function(e){e.preventDefault()})),O.addEventListener("submit",(function(e){e.preventDefault()}));var Z=document.querySelector(".profile__image");Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(t).catch((function(e){console.log(e)})),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t).catch((function(e){console.log(e)}))]).then((function(e){X=e[0]._id,e[1].forEach((function(e){E.append(o(e,{deleteCard:c,likeCard:r,openImage:Y},X))})),C.textContent=e[0].name,S.textContent=e[0].about,Z.style.backgroundImage="url(".concat(e[0].avatar,")")})).catch((function(e){console.log(e)}))})();