(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-26",headers:{authorization:"839b686b-1261-4d4d-8af6-118db8d9e09c","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject("Ошибка ".concat(e.status))}var n=document.querySelector("#card-template").content;function r(e,t,r){var o=t.deleteCard,c=t.likeCard,a=t.openImage,i=n.cloneNode(!0),u=i.querySelector(".card__image"),l=i.querySelector(".card__title"),d=i.querySelector(".card"),s=i.querySelector("#like-count");s.innerHTML=e.likes.length,d.dataset.idcard=e._id,u.src=e.link,u.alt=e.name,l.textContent=e.name,i.querySelector(".card__delete-button").addEventListener("click",o);var m=i.querySelector(".card__like-button");return m.addEventListener("click",(function(e){c(e,s,d,m)})),u.addEventListener("click",a),e.owner._id!=r&&i.querySelector("#card__delete").remove(),i}function o(n,r,o,c){var a;c.classList.contains("card__like-button_is-active")?(a=o.dataset.idcard,fetch("".concat(e.baseUrl,"/cards/likes/").concat(a),{method:"DELETE",headers:e.headers}).then(t)).then((function(e){r.innerHTML=e.likes.length,c.classList.remove("card__like-button_is-active")})).catch((function(e){console.log(e)})):function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then(t)}(o.dataset.idcard).then((function(e){r.innerHTML=e.likes.length,c.classList.add("card__like-button_is-active")})).catch((function(e){console.log(e)}))}function c(t){var n,r=t.target.closest(".card");(n=r.dataset.idcard,fetch("".concat(e.baseUrl,"/cards/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return e.json()}))).then((function(){r.remove()})).catch((function(e){console.log(e)}))}function a(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",u)}function i(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",u)}function u(e){var t=document.querySelector(".popup_is-opened");"Escape"===e.key&&t&&i(t)}function l(e){e.target===e.currentTarget&&i(e.target)}var d=function(e,t,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),r.classList.remove(n.errorClass),r.textContent=" "},s=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",""))},m=function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);n.forEach((function(n){d(e,n,t)})),s(n,r,t)},p=document.querySelector(".places__list"),f=document.querySelector(".profile__description"),v=document.querySelector(".profile__title"),_=document.getElementById("popupNewCard"),y=document.querySelector(".profile__add-button"),h=_.querySelector(".popup__close"),E=document.forms["new-place"],g=E.elements["place-name"],b=E.elements.link,S=document.getElementById("popupEdit"),C=document.querySelector(".profile__edit-button"),L=S.querySelector(".popup__close"),k=document.forms["edit-profile"],q=k.elements.name,x=k.elements.description,B=document.getElementById("popupImage"),I=(document.querySelectorAll(".card__image"),B.querySelector(".popup__close")),A=B.querySelector(".popup__caption"),T=B.querySelector(".popup__image"),U=document.getElementById("editForm"),w=document.getElementById("popupNewPlace"),D=document.getElementById("buttonCard"),N=document.getElementById("buttonEdit"),P=document.getElementById("buttonAvatar"),M=document.querySelector(".profile__image"),H=document.getElementById("popupNewAvatar"),j=H.querySelector(".popup__close"),O=document.forms.avatar,J=O.elements.link,V="",z={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"form__input_type_error",errorClass:"form__input-error_active"};function F(e){a(B),T.src=e.target.src,T.alt=e.target.alt;var t=e.target.closest(".card");A.textContent=t.querySelector(".card__title").textContent}y.addEventListener("click",(function(){a(_),m(_,z)})),h.addEventListener("click",(function(){return i(_)})),_.addEventListener("click",l),M.addEventListener("click",(function(){a(H),m(H,z)})),j.addEventListener("click",(function(){return i(H)})),H.addEventListener("click",l),O.addEventListener("submit",(function(n){var r;n.preventDefault(),P.textContent="Сохранение...",(r=J.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:r})}).then(t)).then((function(e){M.style.backgroundImage="url(".concat(e.avatar,")"),O.reset(),i(H)})).catch((function(e){console.log(e)})).finally((function(){P.textContent="Сохранить"}))})),E.addEventListener("submit",(function(n){var a,u;n.preventDefault(),D.textContent="Сохранение...",(a=g.value,u=b.value,fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:a,link:u})}).then(t)).then((function(e){p.prepend(r(e,{deleteCard:c,likeCard:o,openImage:F},V)),E.reset(),i(_)})).catch((function(e){console.log(e)})).finally((function(){D.textContent="Сохранить"}))})),C.addEventListener("click",(function(){a(S),m(S,z),q.value=v.textContent,x.value=f.textContent})),L.addEventListener("click",(function(){return i(S)})),S.addEventListener("click",l),k.addEventListener("submit",(function(n){var r,o;n.preventDefault(),N.textContent="Сохранение...",v.textContent=q.value,f.textContent=x.value,(r=q.value,o=x.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:r,about:o})}).then(t)).then((function(e){i(S)})).catch((function(e){console.log(e)})).finally((function(){N.textContent="Сохранить"}))})),B.querySelector(".popup__image"),I.addEventListener("click",(function(){return i(B)})),B.addEventListener("click",l),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);s(n,r,t),n.forEach((function(o){o.addEventListener("input",(function(){(function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?d(e,t,n):function(e,t,n,r){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(r.inputErrorClass),o.textContent=n,o.classList.add(r.errorClass)}(e,t,t.validationMessage,n)})(e,o,t),s(n,r,t)}))}))}(t,e)}))}(z),U.addEventListener("submit",(function(e){e.preventDefault()})),w.addEventListener("submit",(function(e){e.preventDefault()}));var G=document.querySelector(".profile__image");Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{headers:e.headers}).then(t),fetch("".concat(e.baseUrl,"/cards"),{headers:e.headers}).then(t)]).then((function(e){V=e[0]._id,e[1].forEach((function(e){p.append(r(e,{deleteCard:c,likeCard:o,openImage:F},V))})),v.textContent=e[0].name,f.textContent=e[0].about,G.style.backgroundImage="url(".concat(e[0].avatar,")")})).catch((function(e){console.log(e)}))})();